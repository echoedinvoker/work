# **_是否應該把程式碼 Refactor?_**

## **Async 最佳解法**

- 看國外討論版，目前最佳解似乎頂多就是用 async/await 把異步平坦化而已。
- 用 function 或者 class 封裝不太實際，因為過程中太多突發問題會產生。

# **_Commit 問題_**

- 今天有遇到因為 Commit 按太多次造成在 DA module 中程式碼重複多次貼上的狀況。
  - 目前是感覺接用複製貼上，並直接在 DA module (非 trainer) 中做 double check 比較安全。

# **_掃描位置錯誤問題_**

## **有無動畫**

- 如果確認完全無動畫的話可以嘗試調整到 waitFor 的 confidence 剛好，發揮 waitFor 的**等待**功能是最流暢的做法。
- 如果有動畫的話，api.sleep 就無法避免，因為動畫的過程中會讓掃描得到錯誤的位置資訊，即使是非常短暫的動畫，例如：
  - **彈**窗。
  - 下拉選單**伸展**開來。

## **彈窗確認問題**

- 有些彈窗彈出來時，確認按鈕會有邊框圖樣造成掃描失敗的問題。
  - 其實有邊框就表示已經 focus 在這個按鈕上了，可以直接使用 api.keyboard.enter() 取代掃描點擊。
  - 如果點擊按鈕前需要做其他動作 (例如 Copy 成功/失敗訊息)，按鈕的 focus 自然會消失，需再做確認。

## **如何做一個「堪用」的技能**

- 先做出能夠讓一輪完整流程順利**演示**給客戶看的東西就好。
- 讓技能留些**缺陷**無法真正在生產中使用，而且這些缺陷盡可能地不影響上面第一輪的演示：
  - 讓迴圈只能跑完**第一輪**就結束。
  - **例外**情況的處理先不做。
  - 跟客戶說需要更多資料做**壓力測試**。

# **_其他技巧_**

## **snapshot.png 與 console.log(currentCrop)判讀**

- 如果 confidence 明明很高，但是 snapshot.png 很奇怪的話...
  - 很有可能是因為**動畫**，掃描與 capture 有時間差，所以會抓到很奇怪的圖檔。

## **不要只針對單一步驟測試**

- 至少要前面兩三步接續到目標步驟，因為步驟有沒有跟前面連貫運行可能跟只執行單一步驟的結果相差很大。

## **DA 使用 Ctrl+0 Snapshot**

- 避免用點擊按鈕的方式，因為這樣 focus 會改變，導致偏離實際技能運作時的狀況。

# **_apmp200_**

> 選擇 UI 熱鍵 ctrl + G

## **單號過濾**

- 流程是從 CSV 中讀取**請購單號**輸入，然後再選擇已確認、已核准，篩選出**單筆**。
  - 會不會有明明 CSV 中有需要處理的資料，但是篩選出來為空，狀況？
    - 若有，是否應該記錄在 CSV 中，並結束此次循環進行下一筆循環？

## **系統自動產生之單號**

- 原本以為可能一個請購單會產生多筆單號，但後來與對方 IT 釐清的結果是，如果只勾選一筆請購單號做拋轉的話，系統自動產生之單號也只會有單筆。
  - 所以這樣同時**避免了一對多需要雙重迴圈**的問題了。(除非對方 IT 唬爛)
- 目前把系統產生的單號寫入 **number.txt** 中。

# **_apmt540-單身_**

## **是否重新預設單價？**

- 這是按 B 進入單身之後，**可能**會出現的提示視窗，卡很久。
  - 問題點在於 Y:是 的**按鈕邊緣有樣式變化**。
    - 目前解決方式是重新抓 CROP，範圍取小一點甚至**外部有些部分沒包到都無所謂**。
    - 更好的解決方式應該是直接 Enter，**下次上線這邊考慮更新**。

## **未稅單價**

- CSV 中提供兩個單價，是否要填兩個？
  - 與 Dannies 釐清是說只需要填**未稅單價**就好，後面的金額都會自動帶出 (所以 CSV 檔案中其中一個金額是多餘)。

## **日期**

- CSV 只給數字，例如 231031，但是需要填入的是 23/10/31，直接使用 reduce 解決。
- 有三個，填寫順序有一個固定模式，否則會卡住。
- 與 Dannies 溝通後解法是在使用 Emily 的電腦中，這三個日期介面設定的排序他們會先弄好。
  - 這樣我們 Emily 機器人就可以僅使用 tab 自動帶入另外兩個日期，省去掃描的風險。

> 所以按 B 進入單身之後，僅有 api.pasteText 與 api.keyboard.tab 被使用而已，完全不需要掃描。

# **_apmt540-單身完成後_**

## **相關文件**

- 文件檔案名稱 Dannies 說會與請購單號相同。
- 文件檔案型態原本可以是 xlsx 或 pdf，與 Dannies 溝通後決定統一使用 **pdf**，這樣可以讓 Emily 省去一個判斷工作。
- IT 是說點擊**文件位置**之後要按**瀏覽**才能選擇檔案，但實測是點完**文件位置**之後直接輸入檔案的路徑也能夠上傳成功。

## **發包價**

- 簡單，沒問題。

## **EasyFlow 簽核**

- 按鈕要點兩次，第一次按完右邊那排按鈕會 reload，然後需要再按一次。 (有 reload 動畫所以要 api.sleep 一下)
  - 有時候第一次按完會直接出現簽核結果，機制不明。
    - 但操作一樣是按兩次，不需要做額外判斷，因為如果直接出結果的話，原本按鈕位置會是空白。
- 目前是把結果 Copy Field 複製內容後，寫在 **result.txt** 中。

# **_CSV 處理_**

> 這部分尚未開始

## **寫入時機**

- 是否應該在系統的操作產生**不可逆的作用**之後(例如 apmp200 系統單號生成、apmt540 簽核完成)，馬上進行 **CSV 寫入**動作。
  - 會想這樣做的原因是如果，整個**技能在中途有失敗而中斷**的話，至少 CSV 上面對系統目前流程的紀錄是正確的。
  - 如果順著這種思維的話，**number.txt** 及 **result.txt** 能寫入的當下就應該去改變原本的 CSV 檔案了。

## **簽核完成的資料移動**

- 本來想說成功與失敗分開來放，但是**感覺沒必要**，而且如果要統計比例的話放在一起搞不好讓人比較好做比較。
- 因為處理完的資料通常會越**累積**越多，而 **CSV 都要完整讀取之後才能 append**，這樣如果資料成長到太過巨大似乎會對效能產生影響(?)

  - 用 **mongo** 儲存已完成的資訊，不過要確認他們電腦環境能夠使用 **wsl**。
  - 或者 **CSV 可以不需要讀取完整資料就能夠 append** 只是我不知道，可能要 google 看看有沒有簡單的 append 方法。

- 已經完成的資料其上傳所使用的檔案是否也應該移動到不同的資料夾？

## **疑慮**

- 已經在用 CSV 跑循環，如果去更動 CSV，會不會對之後的循環產生影響？(**可考慮自己做 Lab 測試**)

# **_關閉視窗，進入下次循環_**

> 這部分尚未開始

# **_下載參數_**

- 是否應該把 CSV 檔案路徑與上傳檔案所在路徑做成下載時需提供的參數？
  - 前者已經是了，但後者尚未照這個方式處理。

# **_遠端_**

- 使用 **Anydesk**，需提前下載。
  - 對方 IT 說 Teams 遠端現在越來越麻煩的樣子，所以改用 Anydesk。
